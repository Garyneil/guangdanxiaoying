<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å…‰å¼¹æ•ˆåº”è‡ªåŠ¨æµ‹è¯•ç³»ç»Ÿ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="style.css"> 
</head>

<body>
  <h1>å…‰å¼¹æ•ˆåº”è‡ªåŠ¨æµ‹è¯•ç³»ç»Ÿ</h1>

  <div class="main">
    <!-- å·¦ä¾§ -->
    <div class="left-panel">
      <!-- LED æ¨¡å— -->
      <div class="box">
        <h3>LED æŒ‡ç¤ºç¯çŠ¶æ€</h3>
        <div>
          <span class="led" id="led1"></span>
          <span class="led" id="led2"></span>
          <span class="led" id="led3"></span>
          <span class="led" id="led4"></span><br/><br/>
          <button onclick="toggleLEDs()">å˜äº®/å˜æš—</button>
        </div>
      </div>
  
      <!-- åšåº¦æ¨¡å— -->
      <div class="box">
        <h3>åšåº¦å€¼ï¼ˆå•ä½ mmï¼‰</h3>

      <!-- é™æ€è¯´æ˜ -->
      <div style="margin-bottom: 6px;">è–„è†œåšåº¦ t</div>

      <!-- è¾“å…¥åŒºåŸŸ -->
      <div class="thickness-row">
        <label for="d1">æ‹‰ä¼¸å‰åšåº¦ t1:</label>
        <input type="number" id="d1" value="1.00" step="0.01">
        <label for="d2">æ‹‰ä¼¸ååšåº¦ t2:</label>
        <input type="number" id="d2" value="0.90" step="0.01">
      </div>

      <div class="result-box">åšåº¦å˜åŒ– Î”t = <span id="delta">?</span></div>
        <button onclick="calculateDelta()">è®¡ç®—åšåº¦å˜åŒ– Î”t</button>
    </div>

    <!-- åŠ¨é•œç§»åŠ¨è·ç¦»æ¨¡å— -->
    <div class="box">
      <h3>åŠ¨é•œç§»åŠ¨è·ç¦»ï¼ˆå•ä½ mmï¼‰</h3>

      <!-- é™æ€è¯´æ˜ -->
      <div style="margin-bottom: 6px;">åŠ¨é•œè·ç¦» d</div>

      <!-- è¾“å…¥åŒºåŸŸ -->
      <div class="thickness-row">
        <label for="d1_dist">ç§»åŠ¨å‰è·ç¦» d1:</label>
        <input type="number" id="d1_dist" value="5.00" step="0.01">
        <label for="d2_dist">ç§»åŠ¨åè·ç¦» d2:</label>
        <input type="number" id="d2_dist" value="5.50" step="0.01">
      </div>

      <div class="result-box">è·ç¦»å˜åŒ– Î”d = <span id="delta_dist">?</span></div>
      <button onclick="calculateDistanceDelta()">è®¡ç®—åŠ¨é•œç§»åŠ¨è·ç¦» Î”d</button>
    </div>

      <!-- æŠ˜å°„ç‡æ¨¡å— -->
      <div class="box">
        <h3>æŠ˜å°„ç‡</h3>
        <div>æŠ˜å°„ç‡è®¡ç®—å…¬å¼ï¼šn = Î”d / Î”t + 1</div><br>
        <div class="result-box">æŠ˜å°„ç‡ n = <span id="result">?</span></div>
        <button onclick="calculate()">è®¡ç®—æŠ˜å°„ç‡ n</button>
      </div>
  
      <div class="box">
        <h3>
          Aç±»ä¸ç¡®å®šåº¦
          <span class="tooltip">
            <strong>å…¬å¼ï¼š</strong><br>
            å¹³å‡å€¼ï¼šğ‘‹Ì„ = (1/N) âˆ‘Xáµ¢<br>
            æ ‡å‡†å·®ï¼šS = âˆš(1/(N-1) âˆ‘(Xáµ¢ - ğ‘‹Ì„)Â²)<br>
            ä¸ç¡®å®šåº¦ï¼šÎ´â‚ = S / âˆšN
          </span>
        </h3>
      
        <div class="result-box">
          æŠ˜å°„ç‡ nâ‚ = <span id="n1">?</span>ï¼Œ
          nâ‚‚ = <span id="n2">?</span>ï¼Œ
          nâ‚ƒ = <span id="n3">?</span><br>
          Aç±»ä¸ç¡®å®šåº¦ï¼š<span id="ua">?</span>
        </div>
      </div>
      
  
      <div class="box">
        <h3>
          Bç±»ä¸ç¡®å®šåº¦
          <span class="tooltip">
            <strong>ä»ªå™¨ç»™å®šï¼š</strong><br>
            åšåº¦ä¸ç¡®å®šåº¦ï¼šSâ‚œ = 0.004 / âˆš3<br>
            ç§»åŠ¨è·ç¦»ä¸ç¡®å®šåº¦ï¼šS<sub>Î”d</sub> = 0.005 / âˆš3
          </span>
        </h3>
      
        <div class="result-box">
          åšåº¦ä¸ç¡®å®šåº¦ï¼šSâ‚œ = 0.0023<br>
          ç§»åŠ¨è·ç¦»ä¸ç¡®å®šåº¦ï¼šS<sub>Î”d</sub> = 0.0029
        </div>
      </div>
    </div>
      
  
    <!-- å³ä¾§ -->
    <div class="right-panel">
      <div class="box image-box">
        <h3>å›¾åƒåŒº</h3>
        <img id="preview" src="https://via.placeholder.com/320x240" alt="å›¾åƒ">
      </div>
      <div class="box chart-box">
        <h3>æ›²çº¿åŒº</h3>
        <div class="curve-selector">
          <label><input type="checkbox" name="curve" value="curve1" checked> æ›²çº¿1</label>
          <label><input type="checkbox" name="curve" value="curve2"> æ›²çº¿2</label>
          <label><input type="checkbox" name="curve" value="curve3"> æ›²çº¿3</label>
        </div>
        <canvas id="myChart"></canvas>
        <button onclick="clearAllCurves()">æ¸…é™¤æ‰€æœ‰æ›²çº¿</button>
      </div>
    </div>
  </div>


  <script>
    const leds = [1, 2, 3, 4].map(i => document.getElementById('led' + i));
    let isOn = false;
  
    function toggleLEDs() {
      isOn = !isOn;
      leds.forEach(led => led.classList.toggle('on', isOn));
    }
  
    function calculateDelta() {
      const d1 = parseFloat(document.getElementById('d1').value);
      const d2 = parseFloat(document.getElementById('d2').value);
      if (!isNaN(d1) && !isNaN(d2)) {
        const delta = Math.abs(d2 - d1);
        document.getElementById('delta').innerText = delta.toFixed(4);
      } else {
        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ d1 å’Œ d2 å€¼');
      }
    }
  
    function calculateDistanceDelta() {
      const d1 = parseFloat(document.getElementById('d1_dist').value);
      const d2 = parseFloat(document.getElementById('d2_dist').value);
      if (!isNaN(d1) && !isNaN(d2)) {
        const delta = Math.abs(d2 - d1);
        document.getElementById('delta_dist').innerText = delta.toFixed(4);
      } else {
        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ d1 å’Œ d2 è·ç¦»å€¼');
      }
    }
  
    const curveDatasets = {
      curve1: { label: "æ›²çº¿1", data: [], borderColor: "#2196f3", tension: 0.4, hidden: false },
      curve2: { label: "æ›²çº¿2", data: [], borderColor: "#f44336", tension: 0.4, hidden: false },
      curve3: { label: "æ›²çº¿3", data: [], borderColor: "#4caf50", tension: 0.4, hidden: false }
    };
  
    let recentNValues = {
      curve1: [],
      curve2: [],
      curve3: []
    };
  
    let currentCurve = "curve1";
  
    // å‹¾é€‰äº‹ä»¶ç»‘å®šï¼ˆcheckboxï¼‰
    document.querySelectorAll('input[name="curve"]').forEach((cb, index) => {
      const curveKey = `curve${index + 1}`;
      cb.value = curveKey;
      cb.addEventListener('click', () => {
        if (cb.checked) currentCurve = cb.value;
      });
      cb.addEventListener('change', updateVisibleCurves);
    });
  
    function calculate() {
      const deltaTText = document.getElementById('delta').innerText;
      const deltaDText = document.getElementById('delta_dist').innerText;
      if (deltaTText !== '?' && deltaDText !== '?') {
        const deltaT = parseFloat(deltaTText);
        const deltaD = parseFloat(deltaDText);
        if (deltaT !== 0) {
          const n = deltaD / deltaT + 1;
          document.getElementById('result').innerText = n.toFixed(4);
          const d2 = parseFloat(document.getElementById('d2').value);
          if (!isNaN(d2)) addNewCurve(d2, n);
        } else {
          alert("Î”t ä¸èƒ½ä¸º 0");
        }
      } else {
        alert('è¯·å…ˆè®¡ç®— Î”t å’Œ Î”d');
      }
    }
  
    function addNewCurve(d2, n) {
      const dataset = curveDatasets[currentCurve];
      if (!dataset) return;
  
      if (dataset.data.length >= 3) dataset.data.shift();
      dataset.data.push({ x: d2, y: n });
  
      const recent = recentNValues[currentCurve];
      recent.unshift(n);
      if (recent.length > 3) recent.pop();
  
      const nDisplayId = currentCurve === "curve1" ? "n1" : currentCurve === "curve2" ? "n2" : "n3";
      document.getElementById(nDisplayId).innerText = n.toFixed(4);
  
      updateVisibleCurves();
      updateUncertainty();
    }
  
    function updateVisibleCurves() {
      const selectedCurves = Array.from(document.querySelectorAll('input[name="curve"]'))
        .filter(cb => cb.checked)
        .map(cb => cb.value);
  
      chart.data.datasets = selectedCurves.map(key => {
        const base = curveDatasets[key];
        return {
          label: base.label,
          data: base.data,
          borderColor: base.borderColor,
          backgroundColor: base.borderColor,
          tension: base.tension,
          fill: false,
          pointBackgroundColor: base.borderColor,
          pointBorderColor: base.borderColor
        };
      });
  
      chart.update();
    }
    

    function updateUncertainty() {
      const allValues = Object.values(recentNValues).flat().filter(n => !isNaN(n));
      if (allValues.length >= 2) {
        const mean = allValues.reduce((a, b) => a + b, 0) / allValues.length;
        const variance = allValues.reduce((sum, x) => sum + (x - mean) ** 2, 0) / (allValues.length - 1);
        const stdDev = Math.sqrt(variance);
        const uncertainty = stdDev / Math.sqrt(allValues.length);
        document.getElementById('ua').innerText = uncertainty.toFixed(4);
      } else {
        document.getElementById('ua').innerText = '?';
      }
    }
  
    function clearAllCurves() {
      // æ¸…ç©ºæ¯æ¡æ›²çº¿çš„æ•°æ®
      Object.values(curveDatasets).forEach(ds => ds.data.splice(0, ds.data.length));

      // æ¸…ç©º recentNValuesï¼ˆç”¨äºä¸ç¡®å®šåº¦å’Œ nâ‚~nâ‚ƒï¼‰
      Object.keys(recentNValues).forEach(k => recentNValues[k] = []);

      // æ¸…ç©º nâ‚ nâ‚‚ nâ‚ƒ å’Œ Aç±»ä¸ç¡®å®šåº¦æ˜¾ç¤º
      document.getElementById("n1").innerText = "?";
      document.getElementById("n2").innerText = "?";
      document.getElementById("n3").innerText = "?";
      document.getElementById("ua").innerText = "?";

      // é‡æ–°æ›´æ–°å›¾è¡¨
      updateVisibleCurves();
    }

    // åˆå§‹åŒ–å›¾è¡¨
    const ctx = document.getElementById('myChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        datasets: []
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: true }
        },
        scales: {
          x: {
            type: 'linear',
            title: { display: true, text: 'åšåº¦ d2 (mm)', color: '#333' },
            ticks: { color: '#333' },
            grid: { color: '#eee' }
          },
          y: {
            title: { display: true, text: 'æŠ˜å°„ç‡ n', color: '#333' },
            beginAtZero: true,
            ticks: { color: '#333' },
            grid: { color: '#eee' }
          }
        }
      }
    });
  </script>
  
</body>
    
